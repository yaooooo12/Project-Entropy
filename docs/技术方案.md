# Project-Entropy 技术方案

## 1. 项目概述

Project-Entropy 是一款 Android 自动点击器应用，专注于模拟真实人类点击行为。通过高斯分布算法、漂移抖动机制和爆发/冷却模式，实现高度拟人化的自动点击功能。

### 1.1 核心特性

- **参数可配置**：用户可自定义点击位置、频率、持续时间等参数
- **悬浮控制球**：始终显示在屏幕上的控制按钮，一键启动/暂停
- **热更新参数**：暂停后修改参数，重启即刻生效
- **拟人化点击**：采用专家级防检测算法，模拟真实人类行为

---

## 2. 功能需求

### 2.1 用户故事

| 角色 | 需求 | 验收标准 |
|------|------|----------|
| 用户 | 配置点击参数 | 可设置点击区域、频率、首次激活等参数 |
| 用户 | 保存/加载配置 | 配置持久化存储，支持多套配置方案 |
| 用户 | 悬浮球控制 | 点击悬浮球启动/暂停任务 |
| 用户 | 实时修改参数 | 暂停状态下修改参数，重启后立即生效 |
| 用户 | 查看运行状态 | 悬浮球显示当前状态（运行中/已暂停） |

### 2.2 功能模块

```
┌─────────────────────────────────────────────────────────┐
│                    Project-Entropy                       │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │
│  │  配置管理   │  │  悬浮球UI   │  │  点击服务       │  │
│  │  Module     │  │  Module     │  │  Module         │  │
│  ├─────────────┤  ├─────────────┤  ├─────────────────┤  │
│  │ - 参数编辑  │  │ - 状态显示  │  │ - 中心激活点击  │  │
│  │ - 配置存储  │  │ - 拖拽移动  │  │ - 点赞循环点击  │  │
│  │ - 配置导入  │  │ - 点击控制  │  │ - 手势分发      │  │
│  │ - 配置导出  │  │ - 最小化   │  │ - 坐标生成      │  │
│  └─────────────┘  └─────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

---

## 3. 技术架构

### 3.1 整体架构

```
┌────────────────────────────────────────────────────────────┐
│                      Presentation Layer                     │
│  ┌──────────────────┐  ┌─────────────────────────────────┐ │
│  │   MainActivity   │  │      FloatingBallService        │ │
│  │   (配置界面)      │  │       (悬浮球控制)               │ │
│  └────────┬─────────┘  └──────────────┬──────────────────┘ │
├───────────┼────────────────────────────┼────────────────────┤
│           │         Domain Layer       │                    │
│  ┌────────▼─────────────────────────────▼──────────────┐   │
│  │                  ClickerManager                      │   │
│  │              (点击任务调度与状态管理)                  │   │
│  └────────┬───────────────────────────────┬────────────┘   │
│           │                               │                 │
│  ┌────────▼────────┐           ┌──────────▼─────────┐      │
│  │  HumanClicker   │           │   ConfigRepository │      │
│  │  (拟人化坐标)    │           │    (配置仓库)       │      │
│  └─────────────────┘           └────────────────────┘      │
├─────────────────────────────────────────────────────────────┤
│                       Service Layer                         │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              ClickAccessibilityService               │   │
│  │           (无障碍服务 - 手势执行引擎)                  │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│                        Data Layer                           │
│  ┌──────────────────┐  ┌────────────────────────────────┐  │
│  │   DataStore      │  │         SharedPreferences      │  │
│  │   (配置持久化)    │  │          (简单设置)             │  │
│  └──────────────────┘  └────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 技术选型

| 类别 | 技术方案 | 说明 |
|------|----------|------|
| 开发语言 | Kotlin | 现代 Android 首选语言 |
| UI 框架 | Jetpack Compose | 声明式 UI，简化开发 |
| 依赖注入 | Hilt | Google 官方推荐 |
| 数据存储 | DataStore | 替代 SharedPreferences |
| 异步处理 | Coroutines + Flow | Kotlin 协程 |
| 无障碍服务 | AccessibilityService | 实现模拟点击 |
| 悬浮窗 | WindowManager | 系统级悬浮窗口 |

### 3.3 权限需求

```xml
<!-- 悬浮窗权限 -->
<uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />

<!-- 前台服务权限 -->
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_SPECIAL_USE" />

<!-- 无障碍服务权限 (通过声明实现) -->
```

---

## 4. 核心模块设计

### 4.1 点击行为流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        点击行为状态机                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│    ┌──────────┐                                                 │
│    │  IDLE    │◄────────────────────────────────────────┐       │
│    │  空闲    │                                          │       │
│    └────┬─────┘                                          │       │
│         │ 用户点击启动                                    │       │
│         ▼                                                │       │
│    ┌──────────────┐                                      │       │
│    │ CENTER_TAP   │  执行中心激活点击                      │       │
│    │ 中心激活      │  (高斯偏移 + 微滑动)                   │       │
│    └────┬─────────┘                                      │       │
│         │ 完成                                           │       │
│         ▼                                                │       │
│    ┌──────────────┐                                      │       │
│    │ REACTION     │  等待 0.8s ~ 1.8s                     │       │
│    │ 反应等待      │  (模拟人眼反应时间)                    │       │
│    └────┬─────────┘                                      │       │
│         │ 超时                                           │       │
│         ▼                                                │       │
│    ┌──────────────┐      ┌──────────────┐               │       │
│    │ LIKE_BURST   │─────►│ LIKE_PAUSE   │               │       │
│    │ 爆发点击      │ 10%  │ 微停顿        │               │       │
│    │ 60-150ms     │◄─────│ 300-600ms    │               │       │
│    └────┬─────────┘  90% └──────────────┘               │       │
│         │                                                │       │
│         │ 用户点击暂停                                    │       │
│         ▼                                                │       │
│    ┌──────────┐                                          │       │
│    │ PAUSED   │──────────────────────────────────────────┘       │
│    │ 已暂停   │  (可修改参数，重启后生效)                          │
│    └──────────┘                                                  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 拟人化坐标生成器

#### 4.2.1 设计原理

**屏幕自适应缩放 (Adaptive Scaling)**
- 基准屏幕：1080 x 1920 (主流 FHD 分辨率)
- 所有像素值配置均基于基准屏幕
- 运行时根据实际屏幕尺寸自动等比缩放
- 确保不同分辨率设备上行为一致

```
缩放公式：
actualPx = basePx × (actualScreenSize / baseScreenSize)

示例 (X轴浮动范围 200px)：
- 1080p 手机: 200 × (1080/1080) = 200px
- 1440p 手机: 200 × (1440/1080) = 267px
- 720p 手机:  200 × (720/1080)  = 133px
```

**高斯分布 (Gaussian Distribution)**
- 使用 `nextGaussian()` 生成正态分布随机数
- 点击点大概率落在目标中心附近
- 偶尔会产生较大偏移，符合人类误差特征

**锚点漂移 (Anchor Drift)**
- 模拟手持手机时的自然姿势调整
- 每次点击有 10% 概率微调锚点位置
- 漂移范围：±5 像素 (基于1080p，自动缩放)

**坐标抖动 (Jitter)**
- 围绕锚点的随机落点
- 标准差：50 像素 (基于1080p，自动缩放)
- 确保点击不会过于集中

**微滑动轨迹 (Micro Slide)**
- 手指按下时会有 2-5 像素的自然位移 (基于1080p，自动缩放)
- 让系统判定为真实触摸而非注入事件

#### 4.2.2 类设计

```kotlin
class HumanClicker(private val metrics: DisplayMetrics) {

    // ========== 基准屏幕 (用于自适应缩放) ==========
    companion object {
        const val BASE_WIDTH = 1080f   // 基准宽度
        const val BASE_HEIGHT = 1920f  // 基准高度
    }

    // ========== 屏幕参数 ==========
    private val screenWidth = metrics.widthPixels
    private val screenHeight = metrics.heightPixels
    private val centerX = screenWidth / 2
    private val centerY = screenHeight / 2

    // ========== 缩放因子 ==========
    private val scaleX = screenWidth / BASE_WIDTH    // X轴缩放因子
    private val scaleY = screenHeight / BASE_HEIGHT  // Y轴缩放因子
    private val scaleAvg = (scaleX + scaleY) / 2     // 平均缩放因子 (用于半径类参数)

    // ========== 可配置参数 (基于1080x1920基准屏幕) ==========
    var likeAnchorXRatio = 0.85f    // 点赞锚点 X 比例 (屏幕比例，无需缩放)
    var likeAnchorYRatio = 0.80f    // 点赞锚点 Y 比例 (屏幕比例，无需缩放)
    var centerFloatRangeX = 200     // 中心点击 X 浮动范围 (基准像素)
    var centerFloatRangeY = 400     // 中心点击 Y 浮动范围 (基准像素)
    var likeJitterRadius = 50       // 点赞抖动半径 (基准像素)
    var driftProbability = 0.1f     // 漂移概率
    var driftRange = 5              // 漂移范围 (基准像素)
    var microSlideMin = 2           // 微滑动最小距离 (基准像素)
    var microSlideMax = 5           // 微滑动最大距离 (基准像素)

    // ========== 运行时状态 ==========
    private var currentLikeAnchorX = screenWidth * likeAnchorXRatio
    private var currentLikeAnchorY = screenHeight * likeAnchorYRatio

    // ========== 缩放方法 ==========
    /** 将基准X像素值转换为实际像素值 */
    fun scaledX(basePx: Int): Float = basePx * scaleX

    /** 将基准Y像素值转换为实际像素值 */
    fun scaledY(basePx: Int): Float = basePx * scaleY

    /** 将基准半径值转换为实际像素值 (使用平均缩放因子) */
    fun scaledRadius(basePx: Int): Float = basePx * scaleAvg

    // ========== 公共方法 ==========
    fun getCenterClickPath(): Path          // 获取中心激活点击路径 (内部自动缩放)
    fun getLikeClickPath(): Path            // 获取点赞点击路径 (内部自动缩放)
    fun getPressDuration(): Long            // 获取拟人化按压时长 (40-100ms)
    fun resetAnchor()                       // 重置锚点位置

    // ========== 私有方法 ==========
    private fun applyGaussianOffset()       // 应用高斯偏移 (使用 scaledX/Y)
    private fun applyDrift()                // 应用锚点漂移 (使用 scaledRadius)
    private fun applyJitter()               // 应用坐标抖动 (使用 scaledRadius)
    private fun createMicroSlidePath()      // 创建微滑动路径 (使用 scaledRadius)
}
```

#### 4.2.3 缩放策略说明

| 参数类型 | 缩放方式 | 说明 |
|----------|----------|------|
| X轴距离 | `scaledX()` | 如 centerFloatRangeX，仅受宽度影响 |
| Y轴距离 | `scaledY()` | 如 centerFloatRangeY，仅受高度影响 |
| 半径/范围 | `scaledRadius()` | 如 jitterRadius、driftRange，使用平均值 |
| 屏幕比例 | 无需缩放 | 如 likeAnchorXRatio，已经是比例值 |
| 时间参数 | 无需缩放 | 如 pressDuration，与屏幕无关 |

### 4.3 点击服务 (AccessibilityService)

#### 4.3.1 服务配置

```xml
<!-- res/xml/accessibility_service_config.xml -->
<accessibility-service
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:description="@string/accessibility_service_description"
    android:accessibilityEventTypes="typeAllMask"
    android:accessibilityFlags="flagRequestFilterKeyEvents|flagDefault"
    android:accessibilityFeedbackType="feedbackGeneric"
    android:notificationTimeout="100"
    android:canRetrieveWindowContent="true"
    android:canPerformGestures="true" />
```

#### 4.3.2 服务架构

```kotlin
class ClickAccessibilityService : AccessibilityService() {

    // ========== 依赖 ==========
    private lateinit var humanClicker: HumanClicker
    private lateinit var configRepository: ConfigRepository

    // ========== 状态 ==========
    private var state: ClickerState = ClickerState.IDLE
    private var currentConfig: ClickConfig? = null

    // ========== 生命周期 ==========
    override fun onServiceConnected()
    override fun onDestroy()

    // ========== 控制接口 ==========
    fun startClicking(config: ClickConfig)
    fun pauseClicking()
    fun resumeClicking()
    fun stopClicking()
    fun updateConfig(config: ClickConfig)    // 热更新配置

    // ========== 点击执行 ==========
    private fun performCenterTap()
    private fun performLikeLoop()
    private fun scheduleNextLike()
    private fun dispatchClick(path: Path, duration: Long)
}
```

### 4.4 悬浮球服务

#### 4.4.1 功能设计

```
┌─────────────────────────────────────────────────┐
│              FloatingBallService                │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │            悬浮球状态                     │   │
│  │  ┌──────┐  ┌──────┐  ┌──────┐          │   │
│  │  │ 空闲 │  │ 运行 │  │ 暂停 │           │   │
│  │  │  ⚪  │  │  🟢  │  │  🟡  │           │   │
│  │  └──────┘  └──────┘  └──────┘          │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │            交互行为                       │   │
│  │  • 单击：启动/暂停任务                    │   │
│  │  • 长按：打开配置界面                     │   │
│  │  • 拖动：移动悬浮球位置                   │   │
│  │  • 双击：快速停止并重置                   │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │            视觉反馈                       │   │
│  │  • 状态颜色变化                          │   │
│  │  • 点击计数显示 (可选)                    │   │
│  │  • 运行时间显示 (可选)                    │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 4.4.2 类设计

```kotlin
class FloatingBallService : Service() {

    // ========== UI 组件 ==========
    private lateinit var windowManager: WindowManager
    private lateinit var floatingView: View
    private lateinit var layoutParams: WindowManager.LayoutParams

    // ========== 状态 ==========
    private var ballState: BallState = BallState.IDLE
    private var clickCount: Int = 0

    // ========== 手势检测 ==========
    private lateinit var gestureDetector: GestureDetector

    // ========== 通信 ==========
    private var clickServiceBinder: ClickAccessibilityService.LocalBinder? = null

    // ========== 公共方法 ==========
    fun updateState(state: BallState)
    fun updateClickCount(count: Int)
    fun moveTo(x: Int, y: Int)
}

enum class BallState {
    IDLE,       // 空闲 - 灰色
    RUNNING,    // 运行中 - 绿色
    PAUSED      // 已暂停 - 黄色
}
```

---

## 5. 数据模型

### 5.1 点击配置

> **注意**：所有像素值参数均基于 **1080 x 1920 基准屏幕**，运行时会根据实际屏幕尺寸自动缩放。

```kotlin
@Serializable
data class ClickConfig(
    val id: String = UUID.randomUUID().toString(),
    val name: String = "默认配置",
    val createdAt: Long = System.currentTimeMillis(),
    val updatedAt: Long = System.currentTimeMillis(),

    // ========== 中心激活点击 ==========
    val enableCenterTap: Boolean = true,           // 是否启用中心激活
    val centerFloatRangeX: Int = 200,              // X轴浮动范围 (基准像素，自动缩放)
    val centerFloatRangeY: Int = 400,              // Y轴浮动范围 (基准像素，自动缩放)
    val centerTapExtraDuration: Long = 50,         // 额外按压时长 (ms)

    // ========== 反应等待 ==========
    val reactionTimeMin: Long = 800,               // 最小反应时间 (ms)
    val reactionTimeMax: Long = 1800,              // 最大反应时间 (ms)

    // ========== 点赞区域 ==========
    val likeAnchorXRatio: Float = 0.85f,           // 锚点X位置 (屏幕比例，无需缩放)
    val likeAnchorYRatio: Float = 0.80f,           // 锚点Y位置 (屏幕比例，无需缩放)
    val likeJitterRadius: Int = 50,                // 抖动半径 (基准像素，自动缩放)

    // ========== 漂移参数 ==========
    val driftProbability: Float = 0.1f,            // 漂移概率 (0-1)
    val driftRange: Int = 5,                       // 漂移范围 (基准像素，自动缩放)

    // ========== 点击节奏 ==========
    val burstIntervalMin: Long = 60,               // 爆发模式最小间隔 (ms)
    val burstIntervalMax: Long = 150,              // 爆发模式最大间隔 (ms)
    val pauseIntervalMin: Long = 300,              // 停顿最小间隔 (ms)
    val pauseIntervalMax: Long = 600,              // 停顿最大间隔 (ms)
    val pauseProbability: Float = 0.1f,            // 停顿概率 (0-1)

    // ========== 按压时长 ==========
    val pressDurationBase: Long = 40,              // 基础按压时长 (ms)
    val pressDurationVariance: Int = 20,           // 按压时长方差

    // ========== 运行限制 ==========
    val maxClickCount: Int = 0,                    // 最大点击次数 (0=无限)
    val maxRunDuration: Long = 0,                  // 最大运行时长 (0=无限, ms)

    // ========== 微滑动 ==========
    val microSlideMin: Int = 2,                    // 微滑动最小距离 (基准像素，自动缩放)
    val microSlideMax: Int = 5                     // 微滑动最大距离 (基准像素，自动缩放)
)
```

#### 参数缩放对照表

| 参数 | 类型 | 缩放方式 | 1080p | 1440p | 720p |
|------|------|----------|-------|-------|------|
| centerFloatRangeX | 基准像素 | scaledX | 200px | 267px | 133px |
| centerFloatRangeY | 基准像素 | scaledY | 400px | 533px | 267px |
| likeJitterRadius | 基准像素 | scaledRadius | 50px | 67px | 33px |
| driftRange | 基准像素 | scaledRadius | 5px | 7px | 3px |
| microSlideMin/Max | 基准像素 | scaledRadius | 2-5px | 3-7px | 1-3px |
| likeAnchorXRatio | 比例 | 无需缩放 | 85% | 85% | 85% |
| likeAnchorYRatio | 比例 | 无需缩放 | 80% | 80% | 80% |

### 5.2 运行状态

```kotlin
data class ClickerState(
    val status: Status,
    val currentConfig: ClickConfig?,
    val clickCount: Int = 0,
    val startTime: Long? = null,
    val lastClickTime: Long? = null
) {
    enum class Status {
        IDLE,           // 空闲
        CENTER_TAP,     // 执行中心点击
        REACTION_WAIT,  // 反应等待
        LIKE_BURST,     // 爆发点击
        LIKE_PAUSE,     // 微停顿
        PAUSED          // 用户暂停
    }

    val runDuration: Long
        get() = startTime?.let { System.currentTimeMillis() - it } ?: 0
}
```

### 5.3 配置仓库

```kotlin
interface ConfigRepository {
    // 配置管理
    suspend fun saveConfig(config: ClickConfig)
    suspend fun getConfig(id: String): ClickConfig?
    suspend fun getAllConfigs(): List<ClickConfig>
    suspend fun deleteConfig(id: String)

    // 当前配置
    suspend fun setCurrentConfigId(id: String)
    suspend fun getCurrentConfig(): ClickConfig?
    val currentConfigFlow: Flow<ClickConfig?>
}
```

---

## 6. UI 设计

### 6.1 主界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  ◄  Project-Entropy                              ⚙️  ⋮    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  ⚠️  无障碍服务未启用                                 │   │
│  │      点击此处前往设置                                 │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  当前配置                                            │   │
│  │  ┌─────────────────────────────────────────────┐    │   │
│  │  │  📋 默认配置                           ✏️  │    │   │
│  │  │  点赞区域: 右下角 (85%, 80%)                │    │   │
│  │  │  点击节奏: 爆发模式 60-150ms               │    │   │
│  │  │  最后修改: 2024-01-15 14:30               │    │   │
│  │  └─────────────────────────────────────────────┘    │   │
│  │                                                      │   │
│  │  ┌───────────────────┐  ┌───────────────────┐       │   │
│  │  │   + 新建配置       │  │   📥 导入配置     │       │   │
│  │  └───────────────────┘  └───────────────────┘       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  配置列表                                            │   │
│  │  ┌─────────────────────────────────────────────┐    │   │
│  │  │  📋 直播点赞                        ○  ⋮   │    │   │
│  │  └─────────────────────────────────────────────┘    │   │
│  │  ┌─────────────────────────────────────────────┐    │   │
│  │  │  📋 快速连点                        ○  ⋮   │    │   │
│  │  └─────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│           ┌─────────────────────────────────┐              │
│           │      ▶️  启动悬浮球              │              │
│           └─────────────────────────────────┘              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 配置编辑界面

```
┌─────────────────────────────────────────────────────────────┐
│  ◄  编辑配置                                    💾  保存  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  配置名称                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  默认配置                                            │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ━━━━━━━━━━━━━━ 中心激活点击 ━━━━━━━━━━━━━━               │
│                                                             │
│  启用中心激活                                    [✓]        │
│                                                             │
│  X轴浮动范围                                               │
│  ──────────────●──────────────  200px                     │
│                                                             │
│  Y轴浮动范围                                               │
│  ──────────────────●──────────  400px                     │
│                                                             │
│  ━━━━━━━━━━━━━━ 反应时间 ━━━━━━━━━━━━━━━━                │
│                                                             │
│  最小等待时间                                               │
│  ────────●────────────────────  800ms                     │
│                                                             │
│  最大等待时间                                               │
│  ──────────────────●──────────  1800ms                    │
│                                                             │
│  ━━━━━━━━━━━━━━ 点赞区域 ━━━━━━━━━━━━━━━━                │
│                                                             │
│  [预览区域 - 显示手机屏幕示意图，标记点赞区域位置]            │
│                                                             │
│  锚点X位置 (屏幕比例)                                       │
│  ──────────────────────●──────  85%                       │
│                                                             │
│  锚点Y位置 (屏幕比例)                                       │
│  ────────────────●────────────  80%                       │
│                                                             │
│  抖动半径                                                   │
│  ──────────●──────────────────  50px                      │
│                                                             │
│  ━━━━━━━━━━━━━━ 点击节奏 ━━━━━━━━━━━━━━━━                │
│                                                             │
│  爆发间隔范围                                               │
│  ●──────────────●              60ms - 150ms               │
│                                                             │
│  停顿间隔范围                                               │
│  ────●──────────────●          300ms - 600ms              │
│                                                             │
│  停顿概率                                                   │
│  ──●──────────────────────────  10%                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.3 悬浮球设计

```
     正常状态              运行状态              暂停状态
    ┌──────┐            ┌──────┐            ┌──────┐
    │      │            │      │            │      │
    │  ⚪  │    ──►     │  🟢  │    ──►     │  🟡  │
    │      │            │ 128  │            │ 128  │
    └──────┘            └──────┘            └──────┘

    交互：               显示：               显示：
    单击启动             点击计数             点击计数
                        动画呼吸             静态显示

    长按：展开菜单
    ┌──────────────────────┐
    │  ⚙️ 配置  │ 🔴 退出 │
    └──────────────────────┘
```

---

## 7. 实现步骤

### 阶段一：项目初始化

1. 创建 Android 项目，配置 Gradle
2. 添加依赖 (Hilt, Compose, DataStore, Kotlinx.serialization)
3. 配置 AndroidManifest.xml (权限、服务声明)
4. 创建基础包结构

### 阶段二：核心功能

1. 实现 `HumanClicker` 拟人化坐标生成器
2. 实现 `ClickAccessibilityService` 无障碍服务
3. 实现 `ClickConfig` 数据模型
4. 实现 `ConfigRepository` 配置存储

### 阶段三：悬浮球

1. 实现 `FloatingBallService` 基础服务
2. 实现悬浮球 UI 和状态切换
3. 实现手势检测 (单击、长按、拖动)
4. 实现与点击服务的通信

### 阶段四：配置界面

1. 实现主界面 (配置列表)
2. 实现配置编辑界面
3. 实现配置导入/导出
4. 实现无障碍服务引导

### 阶段五：优化与测试

1. 性能优化 (内存、电池)
2. 兼容性测试 (不同 Android 版本)
3. 用户体验优化
4. Bug 修复

---

## 8. 包结构

```
com.entropy.clicker/
├── app/
│   ├── EntropyApplication.kt
│   └── di/
│       └── AppModule.kt
│
├── data/
│   ├── model/
│   │   ├── ClickConfig.kt
│   │   └── ClickerState.kt
│   ├── repository/
│   │   ├── ConfigRepository.kt
│   │   └── ConfigRepositoryImpl.kt
│   └── datastore/
│       └── ConfigDataStore.kt
│
├── domain/
│   ├── clicker/
│   │   ├── HumanClicker.kt
│   │   └── ClickerManager.kt
│   └── usecase/
│       ├── SaveConfigUseCase.kt
│       └── GetConfigUseCase.kt
│
├── service/
│   ├── ClickAccessibilityService.kt
│   └── FloatingBallService.kt
│
└── ui/
    ├── main/
    │   ├── MainActivity.kt
    │   ├── MainScreen.kt
    │   └── MainViewModel.kt
    ├── config/
    │   ├── ConfigEditScreen.kt
    │   └── ConfigEditViewModel.kt
    ├── components/
    │   ├── ConfigCard.kt
    │   ├── SliderWithLabel.kt
    │   └── ScreenPreview.kt
    └── theme/
        ├── Theme.kt
        ├── Color.kt
        └── Type.kt
```

---

## 9. 防检测要点总结

| 技术要点 | 实现方式 | 防检测原理 |
|----------|----------|------------|
| 屏幕自适应 | 基于1080p基准屏幕自动缩放 | 不同设备行为一致，避免异常坐标 |
| 首屏中心点击 | 启动时先点击屏幕中心 | 模拟"取消遮罩/聚焦"的人类信号 |
| 高斯分布坐标 | `nextGaussian()` | 点击不精确在正中心，符合人类误差 |
| 微滑动轨迹 | `Path.lineTo()` 2-5像素 (自动缩放) | 系统判定为真实触摸 |
| 反应时间 | 0.8s-1.8s 等待 | 模拟人眼视神经处理时间 |
| 锚点漂移 | 10%概率±5像素 (自动缩放) | 模拟手持姿势微调 |
| 爆发/停顿 | 90%快速，10%停顿 | 模拟人类换气/调整 |
| 按压时长 | 40-100ms 高斯分布 | 避免机械化固定时长 |

---

## 10. 注意事项

### 10.1 法律合规

- 本工具仅供学习研究使用
- 请遵守相关平台的用户协议
- 不得用于任何违法违规用途

### 10.2 技术限制

- 需要用户手动开启无障碍服务
- 需要用户手动授予悬浮窗权限
- Android 11+ 可能有额外权限限制

### 10.3 最佳实践

- 建议点击频率不要设置过高
- 建议设置合理的运行时长限制
- 建议定期更换配置参数
